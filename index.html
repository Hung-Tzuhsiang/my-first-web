<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´ªå­ç¿”çš„è¨˜å¸³æœ¬</title>
    <style>
        body { font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 90%; max-width: 400px; }
        h2 { text-align: center; color: #1a73e8; margin-bottom: 20px; font-weight: 800; }
        
        label { display: block; margin-top: 12px; color: #555; font-size: 0.95em; font-weight: bold; }
        select, input, button { width: 100%; padding: 12px; margin-top: 5px; border-radius: 8px; box-sizing: border-box; border: 1px solid #ccc; font-size: 16px; }
        
        /* é‡å°é¸å–®èˆ‡è¼¸å…¥æ¡†çš„å„ªåŒ– */
        select { background-color: #f8f9fa; cursor: pointer; }
        input:focus, select:focus { border-color: #1a73e8; outline: none; box-shadow: 0 0 5px rgba(26,115,232,0.2); }
        
        /* é€å‡ºæŒ‰éˆ• */
        button { background-color: #1a73e8; color: white; border: none; font-weight: bold; margin-top: 25px; cursor: pointer; transition: 0.2s; font-size: 1.1em; padding: 14px; }
        button:hover { background-color: #1557b0; }
        
        /* è¼‰å…¥å‹•ç•« */
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #1a73e8; border-radius: 50%; width: 25px; height: 25px; animation: spin 1s linear infinite; display: none; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* éš±è—ç´°é …é¸å–®çš„æ¨£å¼ (çµ¦è‡¨æ™‚æ”¶å…¥ç”¨) */
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="card">
        <h2>ğŸ“’ é›²ç«¯è¨˜å¸³æœ¬</h2>
        <form id="accountingForm">
            
            <label>ğŸ“… æ—¥æœŸ</label>
            <input type="date" name="date" id="dateInput" required>

            <label>ğŸ“‚ å¤§é …åˆ†é¡</label>
            <select name="main_cat" id="mainCat" required onchange="updateSubCat()">
                <option value="" disabled selected>è«‹é¸æ“‡...</option>
                <option value="ç”Ÿæ´»è²»æ”¯å‡º">ğŸ” ç”Ÿæ´»è²»æ”¯å‡º</option>
                <option value="æœˆå›ºå®šæ”¯å‡º">ğŸ  æœˆå›ºå®šæ”¯å‡º</option>
                <option value="æœˆå›ºå®šæ”¶å…¥">ğŸ’° æœˆå›ºå®šæ”¶å…¥</option>
                <option value="æœˆè‡¨æ™‚æ”¶å…¥">ğŸ§§ æœˆè‡¨æ™‚æ”¶å…¥</option>
                <option value="å¹´å›ºå®šæ”¯å‡º">ğŸ“… å¹´å›ºå®šæ”¯å‡º</option>
                <option value="å¹´è‡¨æ™‚æ”¶å…¥">ğŸ’ å¹´è‡¨æ™‚æ”¶å…¥</option>
            </select>

            <div id="subCatGroup">
                <label>ğŸ·ï¸ ç´°é …åˆ†é¡</label>
                <select name="sub_cat" id="subCat">
                    <option value="" disabled selected>è«‹å…ˆé¸å¤§é …...</option>
                </select>
            </div>

            <label>ğŸ“ å…§å®¹èªªæ˜ (å¿…å¡«)</label>
            <input type="text" name="content" placeholder="ä¾‹å¦‚: åˆé¤ã€å°¾ç‰™ä¸­ç" required>

            <label>ğŸ’² é‡‘é¡</label>
            <input type="number" name="price" placeholder="è¼¸å…¥é‡‘é¡" required inputmode="numeric">

            <label>ğŸ“ å‚™è¨» (é¸å¡«)</label>
            <input type="text" name="note" placeholder="è£œå……èªªæ˜...">

            <button type="submit" id="submitBtn">é€å‡ºç´€éŒ„</button>
            <div class="loader" id="loader"></div>
        </form>
    </div>

    <script>
        // âš ï¸âš ï¸âš ï¸ è«‹å°‡ä¸‹é¢é€™ä¸²æ›æˆä½ çš„ Apps Script ç¶²å€ âš ï¸âš ï¸âš ï¸
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwlVZK8MTJKlTNajB7B-tzUW_oElpVCNhDXSlwAt6K_CCHxlvTh2qMPK8VH0td_moDF/exec';

        // è¨­å®šæ—¥æœŸé è¨­ç‚ºä»Šå¤©
        document.getElementById('dateInput').valueAsDate = new Date();

        // å®šç¾©ç´°é …é¸å–®è³‡æ–™
        const categories = {
            "ç”Ÿæ´»è²»æ”¯å‡º": ["å€‹äººå¤–é£Ÿ", "å…¶ä»–å¤–é£Ÿ", "æ—¥ç”¨é›œè²¨", "å®¶åº­å¨›æ¨‚", "å€‹äººèŠ±è²»", "å°å­©èŠ±è²»", "äº¤é€šè²»", "é†«ç™‚è²»", "å–œæ…¶ãƒ»äº¤éš›è²»", "å…¶ä»–ç„¡æ³•åˆ†é¡"],
            "æœˆå›ºå®šæ”¯å‡º": ["è£œè²¼å®¶ç”¨", "å­ç¿”-ä¿èª äººå£½", "é›»è©±è²»", "å‹ä¿", "å¥ä¿", "å…¬å¸ç¦åˆ©é‡‘"],
            "æœˆå›ºå®šæ”¶å…¥": ["å…¬å¸è–ªè³‡", "å…¬å¸å‡ºå·®æ´¥è²¼", "å…¬å¸å¤–å®¿æ´¥è²¼", "å…¬å¸è»Šç¨‹æ´¥è²¼"],
            "å¹´å›ºå®šæ”¯å‡º": ["å­ç¿”-å…¨çƒäººå£½", "è‹¡æ©-ä¸­åœ‹äººå£½", "å¾—å€«-ä¸­åœ‹äººå£½", "KUGAä¿éšª", "KUGAç‰Œç…§ç¨…", "KUGAç‡ƒæ–™ç¨…"]
        };

        // é€£å‹•é¸å–®é‚è¼¯
        function updateSubCat() {
            const main = document.getElementById("mainCat").value;
            const subSelect = document.getElementById("subCat");
            const subGroup = document.getElementById("subCatGroup");

            // æ¸…ç©ºèˆŠé¸é …
            subSelect.innerHTML = "";

            // åˆ¤æ–·æ˜¯å¦ç‚ºã€Œè‡¨æ™‚æ”¶å…¥ã€(é€™å…©é …æ²’æœ‰ç´°é …)
            if (main === "æœˆè‡¨æ™‚æ”¶å…¥" || main === "å¹´è‡¨æ™‚æ”¶å…¥") {
                // éš±è—ç´°é …é¸å–®ï¼Œä¸¦è¨­ç‚ºéå¿…å¡«
                subGroup.style.display = "none";
                subSelect.removeAttribute("required");
            } else {
                // é¡¯ç¤ºç´°é …é¸å–®
                subGroup.style.display = "block";
                subSelect.setAttribute("required", ""); // è¨­ç‚ºå¿…å¡«

                // å¡«å…¥å°æ‡‰çš„é¸é …
                const options = categories[main];
                if (options) {
                    options.forEach(opt => {
                        const el = document.createElement("option");
                        el.value = opt;
                        el.innerText = opt;
                        subSelect.appendChild(el);
                    });
                } else {
                    subSelect.innerHTML = "<option>ç„¡ç´°é …</option>";
                }
            }
        }

        // è¡¨å–®é€å‡ºé‚è¼¯
        const form = document.forms['accountingForm'];
        const btn = document.getElementById('submitBtn');
        const loader = document.getElementById('loader');

        form.addEventListener('submit', e => {
            e.preventDefault();
            btn.style.display = 'none';
            loader.style.display = 'block';

            fetch(scriptURL, { method: 'POST', body: new FormData(form)})
                .then(response => {
                    alert('âœ… è¨˜å¸³æˆåŠŸï¼');
                    form.reset(); // æ¸…ç©ºè¡¨å–®
                    document.getElementById('dateInput').valueAsDate = new Date(); // æ—¥æœŸé‡è¨­ç‚ºä»Šå¤©
                    document.getElementById("subCatGroup").style.display = "block"; // æ¢å¾©é¸å–®
                    document.getElementById("subCat").innerHTML = "<option value='' disabled selected>è«‹å…ˆé¸å¤§é …...</option>";
                })
                .catch(error => {
                    alert('âŒ ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
                    console.error('Error!', error.message);
                })
                .finally(() => {
                    btn.style.display = 'block';
                    loader.style.display = 'none';
                });
        });
    </script>
</body>
</html>

